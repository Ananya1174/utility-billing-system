<div class="page-container">
  <div class="page-header">
    <h2>My Utilities</h2>

    <button
      class="primary-btn"
      [disabled]="!canAddUtility"
      (click)="openRequestDialog()">
      ➕ Request Utility
    </button>
  </div>

  <div class="loading" *ngIf="loading">
    Loading utilities...
  </div>

  <div class="empty-state" *ngIf="!loading && !hasUtilities">
    <p>You don’t have any utilities yet.</p>
    <button class="primary-btn" (click)="openRequestDialog()">
      Request Utility
    </button>
  </div>

  <div class="utilities-grid" *ngIf="!loading && hasUtilities">

    <div class="utility-card" *ngFor="let u of utilities">

      <div class="utility-header">
        <h3>{{ u.utilityType }}</h3>

        <span
          class="status"
          [ngClass]="(u.status || u.connectionStatus)?.toLowerCase()">
          {{ u.status || u.connectionStatus }}
        </span>
      </div>

      <div class="details">

        <p>
          <strong>Tariff Plan:</strong>
          {{ u.tariffPlan || u.tariffPlanCode || '—' }}
        </p>

        <p *ngIf="u.meterNumber">
          <strong>Meter Number:</strong>
          {{ u.meterNumber }}
        </p>

        <p *ngIf="u.activatedAt">
          <strong>Activated On:</strong>
          {{ u.activatedAt | date:'mediumDate' }}
        </p>
        <p *ngIf="!u.activatedAt && u.requestedAt">
          <strong>Requested On:</strong>
          {{ u.requestedAt | date:'mediumDate' }}
        </p>
      </div>
      <p class="hint" *ngIf="(u.status || u.connectionStatus) === 'PENDING'">
        Waiting for admin approval
      </p>
    </div>
  </div>
</div>