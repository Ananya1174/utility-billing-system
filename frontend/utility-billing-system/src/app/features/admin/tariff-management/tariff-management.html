<h2>Tariff Management</h2>
<p class="subtitle">Configure tariff plans and slabs for utilities</p>

<div class="filters">
  <select [(ngModel)]="utilityFilter" (change)="onFilterChange()">
    <option value="ALL">All Utilities</option>
    <option value="ELECTRICITY">Electricity</option>
    <option value="WATER">Water</option>
    <option value="GAS">Gas</option>
    <option value="INTERNET">Internet</option>
  </select>

  <label class="checkbox">
    <input type="checkbox"
           [(ngModel)]="activeOnly"
           (change)="onFilterChange()" />
    Active Only
  </label>

  <button class="primary-btn" (click)="showAddPlan = true">
    + Add Tariff Plan
  </button>
</div>

<div class="card">
  <table>
    <thead>
      <tr>
        <th>Plan ID</th>
        <th>Utility</th>
        <th>Plan Code</th>
        <th>Status</th>
        <th class="center">Actions</th>
      </tr>
    </thead>

    <tbody>
      <tr *ngFor="let p of plans">
        <td class="mono">{{ p.id }}</td>
        <td>{{ p.utilityType }}</td>
        <td>{{ p.planCode }}</td>
        <td>
          <span class="status"
                [class.active]="p.active"
                [class.inactive]="!p.active">
            {{ p.active ? 'ACTIVE' : 'INACTIVE' }}
          </span>
        </td>
        <td class="center">
          <button
  *ngIf="p.active"
  class="ghost-btn"
  (click)="openSlabs(p)">
  Manage Slabs
</button>

          <button *ngIf="p.active"
                  class="danger-btn"
                  (click)="openDeactivateDialog(p.id)">
            Deactivate
          </button>
        </td>
      </tr>

      <tr *ngIf="!plans.length">
        <td colspan="5" class="empty">No tariff plans found</td>
      </tr>
    </tbody>
  </table>
</div>

<div
  class="overlay"
  *ngIf="(selectedPlan || showAddPlan) && !confirmPlanVisible && !confirmSlabVisible">
</div>
<div class="modal" *ngIf="showAddPlan">
  <h3>Add Tariff Plan</h3>

  <select [(ngModel)]="newPlan.utilityType">
    <option value="">Select Utility</option>
    <option value="ELECTRICITY">Electricity</option>
    <option value="WATER">Water</option>
    <option value="GAS">Gas</option>
    <option value="INTERNET">Internet</option>
  </select>

  <input type="text"
         placeholder="Plan Code"
         [(ngModel)]="newPlan.planCode" />

  <div class="actions">
    <button class="primary-btn" (click)="addPlan()">Save</button>
    <button class="ghost-btn" (click)="showAddPlan = false">Cancel</button>
  </div>
</div>

<div class="modal wide" *ngIf="selectedPlan">
  <h3>Manage Slabs â€” {{ selectedPlan.planCode }}</h3>

  <table class="slabs-table">
    <thead>
      <tr>
        <th>Min</th>
        <th>Max</th>
        <th>Rate</th>
        <th class="center">Action</th>
      </tr>
    </thead>

    <tbody>
      <tr *ngFor="let s of slabs">
        <td>{{ s.minUnits }}</td>
        <td>{{ s.maxUnits }}</td>
        <td>{{ s.rate }}</td>
        <td class="center">
          <button class="danger-btn small"
                  (click)="openDeleteSlabDialog(s.id)">
            Delete
          </button>
        </td>
      </tr>

      <tr *ngIf="!slabs.length">
        <td colspan="4" class="empty">No slabs defined</td>
      </tr>
    </tbody>
  </table>

  <div class="add-slab">
    <input type="number"
           placeholder="Min Units"
           [(ngModel)]="newSlab.minUnits" />

    <input type="number"
           placeholder="Max Units"
           [(ngModel)]="newSlab.maxUnits" />

    <input type="number"
           placeholder="Rate"
           [(ngModel)]="newSlab.rate" />

    <button class="primary-btn" (click)="addSlab()">
      Add Slab
    </button>
  </div>

  <div class="actions">
    <button class="ghost-btn" (click)="closeSlabs()">Close</button>
  </div>
</div>

<app-confirm-dialog
  [visible]="confirmPlanVisible"
  title="Deactivate Tariff Plan"
  message="Are you sure you want to deactivate this tariff plan?"
  confirmText="Deactivate"
  cancelText="Cancel"
  (confirm)="confirmDeactivate()"
  (cancel)="cancelDeactivate()">
</app-confirm-dialog>

<app-confirm-dialog
  [visible]="confirmSlabVisible"
  title="Delete Tariff Slab"
  message="Are you sure you want to delete this slab? This action cannot be undone."
  (confirm)="confirmDeleteSlab()"
  (cancel)="cancelDeleteSlab()">
</app-confirm-dialog>